<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bang the Table</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background-color: black;
      font-family: sans-serif;
    }

    .container {
      position: relative;
      width: 80%;
      height: 90vh;
      margin: auto;
      background: url('images/table.png') no-repeat center center;
      background-size: cover;
      border: 4px solid #333;
    }

    .hand {
      position: absolute;
      width: 160px;
      height: auto;
      z-index: 10;
      transition: transform 0.1s ease;
      cursor: pointer;
      transform-origin: bottom center;
    }

    .hand.left { left: 20%; top: 80%; }
    .hand.right { left: 60%; top: 80%; }

    .zone {
      position: absolute;
      top: 0;
      height: 100%;
      width: 16.666%;
      pointer-events: none;
    }

    .zone:nth-child(1) { left: 0%; }
    .zone:nth-child(2) { left: 16.666%; }
    .zone:nth-child(3) { left: 33.333%; }
    .zone:nth-child(4) { left: 50%; }
    .zone:nth-child(5) { left: 66.666%; }
    .zone:nth-child(6) { left: 83.333%; }

    .active {
      outline: 3px solid yellow;
    }

    .select-toggle {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 12px;
      background-color: white;
      color: black;
      border-radius: 5px;
      font-size: 14px;
      z-index: 20;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container" id="table">
    <div class="select-toggle" id="toggleSelect">Select Both Hands</div>
    <img src="images/hand_left.png" class="hand left" id="leftHand" />
    <img src="images/hand_right.png" class="hand right" id="rightHand" />

    <!-- Zones for pitch detection -->
    <div class="zone"></div>
    <div class="zone"></div>
    <div class="zone"></div>
    <div class="zone"></div>
    <div class="zone"></div>
    <div class="zone"></div>
  </div>

  <script>
    const container = document.getElementById('table');
    const leftHand = document.getElementById('leftHand');
    const rightHand = document.getElementById('rightHand');
    const toggleSelect = document.getElementById('toggleSelect');

    let activeHands = [];
    let bothHandsMode = false;
    let handOffset = 200;

    const defaultPositions = {
      left: { top: '80%', left: '20%' },
      right: { top: '80%', left: '60%' }
    };

    const bangSounds = [
      new Audio('sounds/clunk.mp3'),
      new Audio('sounds/deep_clunk.mp3'),
      new Audio('sounds/key_clink.mp3'),
      new Audio('sounds/light_tap.mp3'),
      new Audio('sounds/slide.mp3'),
      new Audio('sounds/solid_bang.mp3')
    ];
    bangSounds.forEach(sound => sound.load());

    function resetHandPosition(hand) {
      hand.style.left = defaultPositions[hand.id === 'leftHand' ? 'left' : 'right'].left;
      hand.style.top = defaultPositions[hand.id === 'leftHand' ? 'left' : 'right'].top;
      hand.style.transform = 'rotate(0deg)';
      hand.classList.remove("active");
    }

    function bothHandsAtRest() {
      return leftHand.style.top === defaultPositions.left.top && rightHand.style.top === defaultPositions.right.top;
    }

    function activateHands(hands) {
      activeHands = hands;
      [leftHand, rightHand].forEach(h => h.classList.remove("active"));
      hands.forEach(h => h.classList.add("active"));
    }

    toggleSelect.addEventListener('click', () => {
      bothHandsMode = !bothHandsMode;
      if (bothHandsMode) {
        const leftRect = leftHand.getBoundingClientRect();
        const rightRect = rightHand.getBoundingClientRect();
        handOffset = rightRect.left - leftRect.left;
        activateHands([leftHand]);
        toggleSelect.textContent = 'Return to One Hand Play';
      } else {
        activateHands([]);
        toggleSelect.textContent = 'Select Both Hands';
      }
    });

    leftHand.addEventListener('mouseenter', () => {
      if (!bothHandsMode) activateHands([leftHand]);
    });

    rightHand.addEventListener('mouseenter', () => {
      if (!bothHandsMode) activateHands([rightHand]);
    });

    container.addEventListener('mousemove', (e) => {
      const x = e.clientX;
      const y = e.clientY;

      if (y > window.innerHeight - 20) {
        activeHands.forEach(resetHandPosition);
        activeHands = [];
        bothHandsMode = false;
        toggleSelect.textContent = 'Select Both Hands';
        toggleSelect.style.display = 'none';
        return;
      }

      toggleSelect.style.display = bothHandsAtRest() ? 'block' : 'none';

      if (bothHandsMode && activeHands.length === 1) {
        const dx = x - 80;
        const dy = y - 75;
        leftHand.style.left = `${dx}px`;
        leftHand.style.top = `${dy}px`;
        leftHand.style.transform = `rotate(${(dx - window.innerWidth / 2) / 15}deg)`;

        rightHand.style.left = `${dx + handOffset}px`;
        rightHand.style.top = `${dy}px`;
        rightHand.style.transform = `rotate(${(dx + handOffset - window.innerWidth / 2) / 15}deg)`;
      } else {
        activeHands.forEach(hand => {
          const dx = x - 80;
          const dy = y - 75;
          hand.style.left = `${dx}px`;
          hand.style.top = `${dy}px`;
          hand.style.transform = `rotate(${(dx - window.innerWidth / 2) / 15}deg)`;
        });
      }
    });

    function getBangSound(x) {
      const width = container.offsetWidth;
      const index = Math.floor((x / width) * 6);
      return bangSounds[index] || bangSounds[2];
    }

    container.addEventListener('click', (e) => {
      const handsToPlay = bothHandsMode ? [leftHand, rightHand] : activeHands;
      handsToPlay.forEach(hand => {
        const rect = hand.getBoundingClientRect();
        const sound = getBangSound(rect.left + rect.width / 2);
        hand.style.transform += ' scaleY(0.7)';
        sound.currentTime = 0;
        sound.play();
        setTimeout(() => {
          hand.style.transform = hand.style.transform.replace(' scaleY(0.7)', '');
        }, 100);
      });
    });
  </script>
</body>
</html>